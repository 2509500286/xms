#pragma checksum "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "51dabd1e7803d5089f1260a41b620665bf81addd"
// <auto-generated/>
#pragma warning disable 1591
[assembly: global::Microsoft.AspNetCore.Razor.Hosting.RazorCompiledItemAttribute(typeof(AspNetCore.Views_Entity_RecordsDialog), @"mvc.1.0.view", @"/Views/Entity/RecordsDialog.cshtml")]
namespace AspNetCore
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Mvc;
    using Microsoft.AspNetCore.Mvc.Rendering;
    using Microsoft.AspNetCore.Mvc.ViewFeatures;
#nullable restore
#line 1 "G:\projects\xms_v2\Presentation\Xms.Web\Views\_ViewImports.cshtml"
using Xms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "G:\projects\xms_v2\Presentation\Xms.Web\Views\_ViewImports.cshtml"
using Xms.Core;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "G:\projects\xms_v2\Presentation\Xms.Web\Views\_ViewImports.cshtml"
using Xms.Infrastructure;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "G:\projects\xms_v2\Presentation\Xms.Web\Views\_ViewImports.cshtml"
using Xms.Infrastructure.Utility;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "G:\projects\xms_v2\Presentation\Xms.Web\Views\_ViewImports.cshtml"
using Xms.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "G:\projects\xms_v2\Presentation\Xms.Web\Views\_ViewImports.cshtml"
using Xms.Web.Models;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "G:\projects\xms_v2\Presentation\Xms.Web\Views\_ViewImports.cshtml"
using Xms.Web.Framework;

#line default
#line hidden
#nullable disable
#nullable restore
#line 1 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
using Xms.Schema.Extensions;

#line default
#line hidden
#nullable disable
    [global::Microsoft.AspNetCore.Razor.Hosting.RazorSourceChecksumAttribute(@"SHA1", @"51dabd1e7803d5089f1260a41b620665bf81addd", @"/Views/Entity/RecordsDialog.cshtml")]
    [global::Microsoft.AspNetCore.Razor.Hosting.RazorSourceChecksumAttribute(@"SHA1", @"4b0011d9a8909cdacaf42363c4ba3a5683bc0ece", @"/Views/_ViewImports.cshtml")]
    public class Views_Entity_RecordsDialog : global::Microsoft.AspNetCore.Mvc.Razor.RazorPage<Xms.Web.Models.SelectEntityRecordsDialogModel>
    {
        private static readonly global::Microsoft.AspNetCore.Razor.TagHelpers.TagHelperAttribute __tagHelperAttribute_0 = new global::Microsoft.AspNetCore.Razor.TagHelpers.TagHelperAttribute("id", new global::Microsoft.AspNetCore.Html.HtmlString("searchForm"), global::Microsoft.AspNetCore.Razor.TagHelpers.HtmlAttributeValueStyle.DoubleQuotes);
        private static readonly global::Microsoft.AspNetCore.Razor.TagHelpers.TagHelperAttribute __tagHelperAttribute_1 = new global::Microsoft.AspNetCore.Razor.TagHelpers.TagHelperAttribute("action", new global::Microsoft.AspNetCore.Html.HtmlString("/entity/RecordsDialog"), global::Microsoft.AspNetCore.Razor.TagHelpers.HtmlAttributeValueStyle.DoubleQuotes);
        private static readonly global::Microsoft.AspNetCore.Razor.TagHelpers.TagHelperAttribute __tagHelperAttribute_2 = new global::Microsoft.AspNetCore.Razor.TagHelpers.TagHelperAttribute("onkeydown", new global::Microsoft.AspNetCore.Html.HtmlString("if(event.keyCode==13)return false;"), global::Microsoft.AspNetCore.Razor.TagHelpers.HtmlAttributeValueStyle.DoubleQuotes);
        private static readonly global::Microsoft.AspNetCore.Razor.TagHelpers.TagHelperAttribute __tagHelperAttribute_3 = new global::Microsoft.AspNetCore.Razor.TagHelpers.TagHelperAttribute("method", "post", global::Microsoft.AspNetCore.Razor.TagHelpers.HtmlAttributeValueStyle.DoubleQuotes);
        private static readonly global::Microsoft.AspNetCore.Razor.TagHelpers.TagHelperAttribute __tagHelperAttribute_4 = new global::Microsoft.AspNetCore.Razor.TagHelpers.TagHelperAttribute("class", new global::Microsoft.AspNetCore.Html.HtmlString("form-horizontal"), global::Microsoft.AspNetCore.Razor.TagHelpers.HtmlAttributeValueStyle.DoubleQuotes);
        #line hidden
        #pragma warning disable 0649
        private global::Microsoft.AspNetCore.Razor.Runtime.TagHelpers.TagHelperExecutionContext __tagHelperExecutionContext;
        #pragma warning restore 0649
        private global::Microsoft.AspNetCore.Razor.Runtime.TagHelpers.TagHelperRunner __tagHelperRunner = new global::Microsoft.AspNetCore.Razor.Runtime.TagHelpers.TagHelperRunner();
        #pragma warning disable 0169
        private string __tagHelperStringValueBuffer;
        #pragma warning restore 0169
        private global::Microsoft.AspNetCore.Razor.Runtime.TagHelpers.TagHelperScopeManager __backed__tagHelperScopeManager = null;
        private global::Microsoft.AspNetCore.Razor.Runtime.TagHelpers.TagHelperScopeManager __tagHelperScopeManager
        {
            get
            {
                if (__backed__tagHelperScopeManager == null)
                {
                    __backed__tagHelperScopeManager = new global::Microsoft.AspNetCore.Razor.Runtime.TagHelpers.TagHelperScopeManager(StartTagHelperWritingScope, EndTagHelperWritingScope);
                }
                return __backed__tagHelperScopeManager;
            }
        }
        private global::Microsoft.AspNetCore.Mvc.TagHelpers.FormTagHelper __Microsoft_AspNetCore_Mvc_TagHelpers_FormTagHelper;
        private global::Microsoft.AspNetCore.Mvc.TagHelpers.RenderAtEndOfFormTagHelper __Microsoft_AspNetCore_Mvc_TagHelpers_RenderAtEndOfFormTagHelper;
        private global::Microsoft.AspNetCore.Mvc.Razor.TagHelpers.UrlResolutionTagHelper __Microsoft_AspNetCore_Mvc_Razor_TagHelpers_UrlResolutionTagHelper;
        #pragma warning disable 1998
        public async override global::System.Threading.Tasks.Task ExecuteAsync()
        {
            WriteLiteral("\r\n");
#nullable restore
#line 4 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
  
    Layout = null;

#line default
#line hidden
#nullable disable
            WriteLiteral("\r\n");
#nullable restore
#line 8 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
  
    var mainEntity = Model.EntityList.First();
    var __ModalGuid = Guid.NewGuid().ToString().Replace("-", "");
    DialogModel dialogModel = ViewData["DialogModel"] as DialogModel;

#line default
#line hidden
#nullable disable
            WriteLiteral("\r\n<link rel=\"stylesheet\"");
            BeginWriteAttribute("href", " href=\"", 333, "\"", 424, 2);
            WriteAttributeValue("", 340, "/content/js/jqgird/css/ui.jqgrid-bootstrap.css?v=", 340, 49, true);
#nullable restore
#line 14 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
WriteAttributeValue("", 389, app.PlatformSettings.VersionNumber, 389, 35, false);

#line default
#line hidden
#nullable disable
            EndWriteAttribute();
            WriteLiteral(">\r\n<link rel=\"stylesheet\"");
            BeginWriteAttribute("href", " href=\"", 450, "\"", 550, 2);
            WriteAttributeValue("", 457, "/content/js/jqgird/plugins/bootstrap-datepicker.min.css?v=", 457, 58, true);
#nullable restore
#line 15 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
WriteAttributeValue("", 515, app.PlatformSettings.VersionNumber, 515, 35, false);

#line default
#line hidden
#nullable disable
            EndWriteAttribute();
            WriteLiteral(@">
<!-- （Modal） -->
<div class=""modal fade in"" id=""entityRecordsModal"" tabindex=""-1"" role=""dialog""
     aria-labelledby=""entityRecordsModalLabel"" style=""display:block;"" aria-hidden=""true"">
    <div class=""modal-dialog"">
        <div class=""modal-content"">
            <div class=""modal-header"">
                <button type=""button"" class=""close"" data-dismiss=""modal""
                        aria-hidden=""true"">
                    ×
                </button>
                <h4 class=""modal-title"" id=""entityRecordsModalLabel"">
                    <span class=""glyphicon glyphicon-th""></span> ");
#nullable restore
#line 27 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                                            Write(mainEntity.LocalizedName);

#line default
#line hidden
#nullable disable
            WriteLiteral(" - ");
#nullable restore
#line 27 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                                                                        Write(Model.QueryView.Name);

#line default
#line hidden
#nullable disable
            WriteLiteral(" - ");
#nullable restore
#line 27 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                                                                                                Write(app.T["queryview"]);

#line default
#line hidden
#nullable disable
            WriteLiteral("\r\n                </h4>\r\n            </div>\r\n            <div class=\"modal-body\">\r\n                <div id=\"queryview-section\">\r\n                    <div class=\"container-fluid\">\r\n                        ");
            __tagHelperExecutionContext = __tagHelperScopeManager.Begin("form", global::Microsoft.AspNetCore.Razor.TagHelpers.TagMode.StartTagAndEndTag, "51dabd1e7803d5089f1260a41b620665bf81addd9584", async() => {
                WriteLiteral("\r\n                            ");
#nullable restore
#line 34 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                       Write(Html.HiddenFor(x => x.EntityId));

#line default
#line hidden
#nullable disable
                WriteLiteral("\r\n                            ");
#nullable restore
#line 35 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                       Write(Html.HiddenFor(x => x.QueryId, new { id = "SelectEntityRecordsQueryId" }));

#line default
#line hidden
#nullable disable
                WriteLiteral("\r\n                            ");
#nullable restore
#line 36 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                       Write(Html.HiddenFor(x => x.SortBy));

#line default
#line hidden
#nullable disable
                WriteLiteral("\r\n                            ");
#nullable restore
#line 37 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                       Write(Html.HiddenFor(x => x.SortDirection));

#line default
#line hidden
#nullable disable
                WriteLiteral("\r\n                            <input type=\"hidden\" value=\"1\" name=\"page\" />\r\n                            <input type=\"hidden\" name=\"QField\" id=\"QField\"");
                BeginWriteAttribute("value", " value=\"", 2014, "\"", 2035, 1);
#nullable restore
#line 39 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
WriteAttributeValue("", 2022, Model.QField, 2022, 13, false);

#line default
#line hidden
#nullable disable
                EndWriteAttribute();
                WriteLiteral(" />\r\n                            <input type=\"hidden\" name=\"mutilChecker\" id=\"mutilChecker\"");
                BeginWriteAttribute("value", " value=\"", 2127, "\"", 2135, 0);
                EndWriteAttribute();
                WriteLiteral(@" />
                            <div class=""form-group"">
                                <div class=""col-sm-2"">
                                    <a id=""fieldDropdown"" class=""dropdown-toggle btn btn-link btn-sm"" data-toggle=""dropdown"" href=""#"">
                                        <span>");
#nullable restore
#line 44 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                         Write(app.T["search_allfield"]);

#line default
#line hidden
#nullable disable
                WriteLiteral("</span> <span class=\"caret\"></span>\r\n                                    </a>\r\n                                    <ul class=\"dropdown-menu\">\r\n                                        <li><a href=\"javascript:void(0)\" data-name=\"\">");
#nullable restore
#line 47 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                                                                 Write(app.T["search_allfield"]);

#line default
#line hidden
#nullable disable
                WriteLiteral("</a></li>\r\n");
#nullable restore
#line 48 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                         foreach (var cell in Model.Grid.Rows[0].Cells)
                                        {
                                            var isrelated = cell.Name.IndexOf(".") > 0;
                                            var k = isrelated ? cell.Name.Split('.')[1] : cell.Name.ToLower();
                                            var label = cell.Label;
                                            Xms.Schema.Domain.Attribute attr = null;
                                            if (!isrelated)
                                            {
                                                attr = Model.AttributeList.Find(n => n.EntityId == mainEntity.EntityId && n.Name.IsCaseInsensitiveEqual(k));
                                                //label = attr.LocalizedName;
                                            }
                                            else
                                            {
                                                attr = Model.AttributeList.Find(n => n.EntityName.IsCaseInsensitiveEqual(cell.EntityName) && n.Name.IsCaseInsensitiveEqual(k));
                                                //显示字段+引用字段
                                                //var relationship = Model.RelationShipList.Find(n => n.Name.IsCaseInsensitiveEqual(cell.Name.Split('.')[0]));
                                                //label = attr.LocalizedName + "(" + relationship.ReferencingAttributeLocalizedName + ")";
                                            }
                                            if (attr == null || attr.TypeIsDateTime()) { continue; }

#line default
#line hidden
#nullable disable
                WriteLiteral("                                            <li><a href=\"javascript:void(0)\" data-name=\"");
#nullable restore
#line 67 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                                                                   Write(cell.Name.ToLower());

#line default
#line hidden
#nullable disable
                WriteLiteral("\" data-type=\"");
#nullable restore
#line 67 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                                                                                                    Write(attr.AttributeTypeName);

#line default
#line hidden
#nullable disable
                WriteLiteral("\">");
#nullable restore
#line 67 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                                                                                                                             Write(cell.Label);

#line default
#line hidden
#nullable disable
                WriteLiteral("</a></li>\r\n");
#nullable restore
#line 68 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                        }

#line default
#line hidden
#nullable disable
                WriteLiteral(@"                                    </ul>
                                </div>
                                <div class="" col-sm-4"" style=""width:282px;"">
                                    <div class=""input-group input-group-sm"">
                                        ");
#nullable restore
#line 73 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                   Write(Html.TextBoxFor(x => x.Q, new { @class = "form-control", @style = "width:200px;", @placeholder = app.T["search_quickly"] }));

#line default
#line hidden
#nullable disable
                WriteLiteral(@"
                                        <span class=""input-group-btn"">
                                            <button class=""btn btn-default"" type=""button"" name=""clearBtn"">
                                                <span class=""glyphicon glyphicon-remove-sign""></span>
                                            </button>
                                            <button class=""btn btn-default"" type=""button"" name=""searchBtn"">
                                                <span class=""glyphicon glyphicon-search""></span>
                                            </button>
                                        </span>
                                    </div>
                                </div>
                                <div class=""input-group input-group-sm col-sm-3"" id=""filterSearcher"">
                                </div>
                            </div>
                        ");
            }
            );
            __Microsoft_AspNetCore_Mvc_TagHelpers_FormTagHelper = CreateTagHelper<global::Microsoft.AspNetCore.Mvc.TagHelpers.FormTagHelper>();
            __tagHelperExecutionContext.Add(__Microsoft_AspNetCore_Mvc_TagHelpers_FormTagHelper);
            __Microsoft_AspNetCore_Mvc_TagHelpers_RenderAtEndOfFormTagHelper = CreateTagHelper<global::Microsoft.AspNetCore.Mvc.TagHelpers.RenderAtEndOfFormTagHelper>();
            __tagHelperExecutionContext.Add(__Microsoft_AspNetCore_Mvc_TagHelpers_RenderAtEndOfFormTagHelper);
            __tagHelperExecutionContext.AddHtmlAttribute(__tagHelperAttribute_0);
            __tagHelperExecutionContext.AddHtmlAttribute(__tagHelperAttribute_1);
            __tagHelperExecutionContext.AddHtmlAttribute(__tagHelperAttribute_2);
            __Microsoft_AspNetCore_Mvc_TagHelpers_FormTagHelper.Method = (string)__tagHelperAttribute_3.Value;
            __tagHelperExecutionContext.AddTagHelperAttribute(__tagHelperAttribute_3);
            __tagHelperExecutionContext.AddHtmlAttribute(__tagHelperAttribute_4);
            await __tagHelperRunner.RunAsync(__tagHelperExecutionContext);
            if (!__tagHelperExecutionContext.Output.IsContentModified)
            {
                await __tagHelperExecutionContext.SetOutputContentAsync();
            }
            Write(__tagHelperExecutionContext.Output);
            __tagHelperExecutionContext = __tagHelperScopeManager.End();
            WriteLiteral(@"
                    </div>
                    <div class=""panel panel-default "" id=""gridview"" style=""margin-bottom:0;"">
                        <div class=""table-responsive"" style=""min-height:300px;max-height:350px;"">
                            <table class=""table table-hover table-striped table-condensed datatable""");
            BeginWriteAttribute("id", " id=\"", 6270, "\"", 6275, 0);
            EndWriteAttribute();
            WriteLiteral(" data-pageurl=\"");
#nullable restore
#line 91 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                                                                                                    Write(app.Url);

#line default
#line hidden
#nullable disable
            WriteLiteral("\" data-ajax=\"true\" data-ajaxcontainer=\"gridview\" data-ajaxcallback=\"EntityRecordsModel");
#nullable restore
#line 91 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                                                                                                                                                                                                   Write(__ModalGuid);

#line default
#line hidden
#nullable disable
            WriteLiteral(".ajaxgrid_reset()\" data-sortby=\"");
#nullable restore
#line 91 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                                                                                                                                                                                                                                                Write(Model.SortBy.ToLower());

#line default
#line hidden
#nullable disable
            WriteLiteral("\" data-sortdirection=\"");
#nullable restore
#line 91 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                                                                                                                                                                                                                                                                                             Write(Model.SortDirection);

#line default
#line hidden
#nullable disable
            WriteLiteral("\" data-singlemode=\"");
#nullable restore
#line 91 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                                                                                                                                                                                                                                                                                                                                    Write(dialogModel.SingleMode);

#line default
#line hidden
#nullable disable
            WriteLiteral(@""" style=""table-layout:fixed;"">
                                <thead>
                                    <tr>
                                        <th width=""22""><input type=""checkbox"" name=""checkall"" /></th>
                                        <th width=""35""></th>
");
#nullable restore
#line 96 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                         foreach (var cell in Model.Grid.Rows[0].Cells)
                                        {
                                            var isrelated = cell.Name.IndexOf(".") > 0;
                                            var k = isrelated ? cell.Name.Split('.')[1] : cell.Name.ToLower();
                                            var label = cell.Label;
                                            var itemStr = "";
                                            Xms.Schema.Domain.Attribute attr = null;
                                            if (!isrelated)
                                            {
                                                attr = Model.AttributeList.Find(n => n.EntityId == mainEntity.EntityId && n.Name.IsCaseInsensitiveEqual(k));
                                                //label = attr.LocalizedName;
                                            }
                                            else
                                            {
                                                attr = Model.AttributeList.Find(n => n.EntityName.IsCaseInsensitiveEqual(cell.EntityName) && n.Name.IsCaseInsensitiveEqual(k));
                                                //显示字段+引用字段
                                                //var relationship = Model.RelationShipList.Find(n => n.Name.IsCaseInsensitiveEqual(cell.Name.Split('.')[0]));
                                                //label = attr.LocalizedName + "(" + relationship.ReferencingAttributeLocalizedName + ")";
                                            }
                                            if (attr == null) { continue; }

                                            if (attr.TypeIsPickList() || attr.TypeIsBit() || attr.TypeIsStatus() || attr.TypeIsState())
                                            {
                                                itemStr = (attr.TypeIsPickList() || attr.TypeIsStatus()) ? attr.OptionSet.Items.SerializeToJson() : attr.PickLists.SerializeToJson();
                                            }

#line default
#line hidden
#nullable disable
            WriteLiteral("                                            <th data-name=\"");
#nullable restore
#line 121 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                                      Write(cell.Name.ToLower());

#line default
#line hidden
#nullable disable
            WriteLiteral("\"");
            BeginWriteAttribute("style", " style=\"", 9016, "\"", 9048, 2);
            WriteAttributeValue("", 9024, "width:", 9024, 6, true);
#nullable restore
#line 121 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
WriteAttributeValue("", 9030, cell.Width+"px", 9030, 18, false);

#line default
#line hidden
#nullable disable
            EndWriteAttribute();
            WriteLiteral(" data-label=\"");
#nullable restore
#line 121 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                                                                                                         Write(cell.Label);

#line default
#line hidden
#nullable disable
            WriteLiteral("\" data-type=\"");
#nullable restore
#line 121 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                                                                                                                                 Write(attr.AttributeTypeName);

#line default
#line hidden
#nullable disable
            WriteLiteral("\" data-opts=\'");
#nullable restore
#line 121 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                                                                                                                                                                     Write(Html.UrlEncoder.Encode(itemStr));

#line default
#line hidden
#nullable disable
            WriteLiteral("\' data-entityid=\"");
#nullable restore
#line 121 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                                                                                                                                                                                                                      Write(attr.ReferencedEntityId);

#line default
#line hidden
#nullable disable
            WriteLiteral("\" data-referencedentityid=\"");
#nullable restore
#line 121 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                                                                                                                                                                                                                                                                         Write(attr.ReferencedEntityId);

#line default
#line hidden
#nullable disable
            WriteLiteral("\">\r\n                                            </th>\r\n");
#nullable restore
#line 123 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                        }

#line default
#line hidden
#nullable disable
            WriteLiteral("                                    </tr>\r\n                                </thead>\r\n                                <tbody>\r\n");
#nullable restore
#line 127 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                      
                                        var primaryKey = Model.AttributeList.Find(n => n.EntityId == mainEntity.EntityId && n.TypeIsPrimaryKey());
                                        var primaryField = Model.AttributeList.Find(n => n.EntityId == mainEntity.EntityId && n.IsPrimaryField == true);
                                    

#line default
#line hidden
#nullable disable
#nullable restore
#line 131 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                     foreach (var item in Model.Items)
                                    {
                                        var lines = (item as IDictionary<string, object>).ToList();
                                        var id = lines.Find(n => n.Key.IsCaseInsensitiveEqual(primaryKey.Name)).Value;
                                        var name = lines.Find(n => n.Key.IsCaseInsensitiveEqual(primaryField.Name)).Value;

#line default
#line hidden
#nullable disable
            WriteLiteral("                                        <tr data-dbclick=\"EntityRecordsModel");
#nullable restore
#line 136 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                                                        Write(__ModalGuid);

#line default
#line hidden
#nullable disable
            WriteLiteral(".selectedrow(\'");
#nullable restore
#line 136 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                                                                                   Write(id);

#line default
#line hidden
#nullable disable
            WriteLiteral("\')\" data-id=\"");
#nullable restore
#line 136 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                                                                                                   Write(id);

#line default
#line hidden
#nullable disable
            WriteLiteral("\">\r\n                                            <td>\r\n                                                <input type=\"checkbox\" name=\"recordid\"");
            BeginWriteAttribute("value", " value=\"", 10570, "\"", 10581, 1);
#nullable restore
#line 138 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
WriteAttributeValue("", 10578, id, 10578, 3, false);

#line default
#line hidden
#nullable disable
            EndWriteAttribute();
            WriteLiteral(" />\r\n                                            </td>\r\n                                            <td>\r\n                                                <input type=\"hidden\" name=\"recordname\"");
            BeginWriteAttribute("value", " value=\"", 10774, "\"", 10787, 1);
#nullable restore
#line 141 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
WriteAttributeValue("", 10782, name, 10782, 5, false);

#line default
#line hidden
#nullable disable
            EndWriteAttribute();
            WriteLiteral(" />\r\n                                                <a class=\"btn btn-link btn-xs selectBtn\"><span class=\"glyphicon glyphicon-ok\"></span></a>\r\n                                            </td>\r\n");
#nullable restore
#line 144 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                             foreach (var cell in Model.Grid.Rows[0].Cells)
                                            {
                                                var columnName = cell.Name.ToLower();
                                                var isrelated = columnName.IndexOf(".") > 0;
                                                var attrName = isrelated ? columnName.Split('.')[1] : columnName;
                                                Xms.Schema.Domain.Attribute attr = null;
                                                if (isrelated)
                                                {
                                                    attr = Model.AttributeList.Find(n => n.EntityName.IsCaseInsensitiveEqual(cell.EntityName) && n.Name.IsCaseInsensitiveEqual(attrName));
                                                }
                                                else
                                                {
                                                    attr = Model.AttributeList.Find(n => n.EntityId == mainEntity.EntityId && n.Name.IsCaseInsensitiveEqual(attrName));
                                                }
                                                if (attr == null)
                                                {
                                                    continue;
                                                }
                                                if (attr.TypeIsPrimaryKey() || attr.TypeIsLookUp() || attr.TypeIsOwner())
                                                {
                                                    columnName = attr.TypeIsPrimaryKey() ? primaryField.Name : columnName += "Name";
                                                    var value = lines.Find(n => n.Key.IsCaseInsensitiveEqual(columnName)).Value;
                                                    var recordid = lines.Find(n => n.Key.IsCaseInsensitiveEqual(cell.Name)).Value;

#line default
#line hidden
#nullable disable
            WriteLiteral("                                                    <td>\r\n");
#nullable restore
#line 168 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                                         if (attr.TypeIsPrimaryKey() || attr.DisplayStyle == "link")
                                                        {

#line default
#line hidden
#nullable disable
            WriteLiteral("                                                            <a");
            BeginWriteAttribute("href", " href=\"", 13287, "\"", 13392, 5);
#nullable restore
#line 170 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
WriteAttributeValue("", 13294, "/"+app.OrganizationUniqueName, 13294, 33, false);

#line default
#line hidden
#nullable disable
            WriteAttributeValue("", 13327, "/entity/edit?entityid=", 13327, 22, true);
#nullable restore
#line 170 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
WriteAttributeValue("", 13349, attr.ReferencedEntityId, 13349, 24, false);

#line default
#line hidden
#nullable disable
            WriteAttributeValue("", 13373, "&recordid=", 13373, 10, true);
#nullable restore
#line 170 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
WriteAttributeValue("", 13383, recordid, 13383, 9, false);

#line default
#line hidden
#nullable disable
            EndWriteAttribute();
            WriteLiteral(" target=\"_blank\"");
            BeginWriteAttribute("title", " title=\"", 13409, "\"", 13417, 0);
            EndWriteAttribute();
            WriteLiteral("> ");
#nullable restore
#line 170 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                                                                                                                                                                              Write(value);

#line default
#line hidden
#nullable disable
            WriteLiteral(" </a>\r\n");
#nullable restore
#line 171 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                                        }
                                                        else
                                                        {
                                                            

#line default
#line hidden
#nullable disable
#nullable restore
#line 174 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                                       Write(value);

#line default
#line hidden
#nullable disable
#nullable restore
#line 174 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                                                  
                                                        }

#line default
#line hidden
#nullable disable
            WriteLiteral("                                                    </td>\r\n");
#nullable restore
#line 177 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                                }
                                                else if (attr.TypeIsPickList() || attr.TypeIsBit() || attr.TypeIsState() || attr.TypeIsStatus())
                                                {
                                                    columnName += "Name";
                                                    var value = lines.Find(n => n.Key.IsCaseInsensitiveEqual(columnName)).Value;

#line default
#line hidden
#nullable disable
            WriteLiteral("                                                    <td> ");
#nullable restore
#line 182 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                                    Write(value);

#line default
#line hidden
#nullable disable
            WriteLiteral(" </td>\r\n");
#nullable restore
#line 183 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                                }
                                                else
                                                {
                                                    var value = lines.Find(n => n.Key.IsCaseInsensitiveEqual(columnName)).Value;
                                                    if (value != null && (attr.TypeIsDecimal()
                                                                    || attr.TypeIsFloat()))
                                                    {
                                                        value = string.Format("{0:N2}", value);
                                                    }
                                                    else if (value != null && attr.TypeIsMoney())
                                                    {
                                                        value = string.Format("￥{0:N2}", value);
                                                    }
                                                    else if (value != null && attr.TypeIsDateTime())
                                                    {
                                                        if (attr.DataFormat == "yyyy/MM/dd")
                                                        {
                                                            value = DateTime.Parse(value + "").ToString("yyyy/MM/dd");
                                                        }
                                                        value = string.Format("{0:G}", value);
                                                    }
                                                    else if (attr.IsPrimaryField)
                                                    {
                                                        value = string.Format("<a href=\"/" + app.OrganizationUniqueName + "/entity/create?entityid={0}&recordid={1}\" target=\"_blank\">{2}</a>", mainEntity.EntityId, id, value);
                                                    }

#line default
#line hidden
#nullable disable
            WriteLiteral("                                                    <td>");
#nullable restore
#line 208 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                                   Write(Html.Raw(value));

#line default
#line hidden
#nullable disable
            WriteLiteral("</td>\r\n");
#nullable restore
#line 209 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                                }
                                            }

#line default
#line hidden
#nullable disable
            WriteLiteral("                                        </tr>\r\n");
#nullable restore
#line 212 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                    }

#line default
#line hidden
#nullable disable
            WriteLiteral(@"                                </tbody>
                            </table>
                        </div>
                        <div class=""panel-footer"">
                            <div class=""row"">
                                <div class=""col-sm-4"">
                                    ");
#nullable restore
#line 219 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                Write(app.T["pagination_label"].Replace("{page}", Model.Page.ToString()).Replace("{totalpages}", Model.TotalPages.ToString()).Replace("{totalitems}", Model.TotalItems.ToString()));

#line default
#line hidden
#nullable disable
            WriteLiteral("\r\n                                </div>\r\n                                <div id=\"page-selection\" class=\"col-sm-8 page-selection\" data-total=\"");
#nullable restore
#line 221 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                                                                                Write(Model.TotalPages);

#line default
#line hidden
#nullable disable
            WriteLiteral("\" data-page=\"");
#nullable restore
#line 221 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                                                                                                              Write(Model.Page);

#line default
#line hidden
#nullable disable
            WriteLiteral("\"></div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"selectEntityRecords-datagrid\"></div>\r\n                </div>\r\n                <script");
            BeginWriteAttribute("src", " src=\"", 17522, "\"", 17599, 2);
            WriteAttributeValue("", 17528, "/content/js/jquery.bootpag.min.js?v=", 17528, 36, true);
#nullable restore
#line 227 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
WriteAttributeValue("", 17564, app.PlatformSettings.VersionNumber, 17564, 35, false);

#line default
#line hidden
#nullable disable
            EndWriteAttribute();
            WriteLiteral("></script>\r\n                <script");
            BeginWriteAttribute("src", " src=\"", 17635, "\"", 17705, 2);
            WriteAttributeValue("", 17641, "/content/js/jquery.form.js?v=", 17641, 29, true);
#nullable restore
#line 228 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
WriteAttributeValue("", 17670, app.PlatformSettings.VersionNumber, 17670, 35, false);

#line default
#line hidden
#nullable disable
            EndWriteAttribute();
            WriteLiteral("></script>\r\n                <script");
            BeginWriteAttribute("src", " src=\"", 17741, "\"", 17854, 2);
            WriteAttributeValue("", 17747, "/content/js/bootstrap-datepicker-1.5.0/js/bootstrap-datepicker.min.js?v=", 17747, 72, true);
#nullable restore
#line 229 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
WriteAttributeValue("", 17819, app.PlatformSettings.VersionNumber, 17819, 35, false);

#line default
#line hidden
#nullable disable
            EndWriteAttribute();
            WriteLiteral("></script>\r\n                <script");
            BeginWriteAttribute("src", " src=\"", 17890, "\"", 18014, 2);
            WriteAttributeValue("", 17896, "/content/js/bootstrap-datepicker-1.5.0/locales/bootstrap-datepicker.zh-CN.min.js?v=", 17896, 83, true);
#nullable restore
#line 230 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
WriteAttributeValue("", 17979, app.PlatformSettings.VersionNumber, 17979, 35, false);

#line default
#line hidden
#nullable disable
            EndWriteAttribute();
            WriteLiteral(" charset=\"UTF-8\"></script>\r\n                ");
            __tagHelperExecutionContext = __tagHelperScopeManager.Begin("script", global::Microsoft.AspNetCore.Razor.TagHelpers.TagMode.StartTagAndEndTag, "51dabd1e7803d5089f1260a41b620665bf81addd44835", async() => {
            }
            );
            __Microsoft_AspNetCore_Mvc_Razor_TagHelpers_UrlResolutionTagHelper = CreateTagHelper<global::Microsoft.AspNetCore.Mvc.Razor.TagHelpers.UrlResolutionTagHelper>();
            __tagHelperExecutionContext.Add(__Microsoft_AspNetCore_Mvc_Razor_TagHelpers_UrlResolutionTagHelper);
            BeginAddHtmlAttributeValues(__tagHelperExecutionContext, "src", 2, global::Microsoft.AspNetCore.Razor.TagHelpers.HtmlAttributeValueStyle.DoubleQuotes);
            AddHtmlAttributeValue("", 18072, "~/content/js/fetch.js?v=", 18072, 24, true);
#nullable restore
#line 231 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
AddHtmlAttributeValue("", 18096, app.PlatformSettings.VersionNumber, 18096, 35, false);

#line default
#line hidden
#nullable disable
            EndAddHtmlAttributeValues(__tagHelperExecutionContext);
            await __tagHelperRunner.RunAsync(__tagHelperExecutionContext);
            if (!__tagHelperExecutionContext.Output.IsContentModified)
            {
                await __tagHelperExecutionContext.SetOutputContentAsync();
            }
            Write(__tagHelperExecutionContext.Output);
            __tagHelperExecutionContext = __tagHelperScopeManager.End();
            WriteLiteral("\r\n");
#nullable restore
#line 232 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                  await Html.RenderPartialAsync("FetchLabel"); 

#line default
#line hidden
#nullable disable
            WriteLiteral("                <script>\r\n                ;(function () {\r\n                    var MODAL_GUID = \'");
#nullable restore
#line 235 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                 Write(Html.Raw(__ModalGuid));

#line default
#line hidden
#nullable disable
            WriteLiteral(@"';
                    var EntityRecordsModel = {
                        dialogid: '#entityRecordsModal',
                        dialog: $('#entityRecordsModal'),
                        datatable: $('#entityRecordsModal .datatable'),
                        pageUrl: $(""#entityRecordsModal .datatable"").attr('data-pageurl'),
                        queryid: '");
#nullable restore
#line 241 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                             Write(Html.Raw(Model.QueryId));

#line default
#line hidden
#nullable disable
            WriteLiteral("\',\r\n                        entityid: \'");
#nullable restore
#line 242 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                              Write(Html.Raw(Model.EntityId));

#line default
#line hidden
#nullable disable
            WriteLiteral("\',\r\n                        cacheFilters:new Xms.Fetch.FilterExpression(),\r\n                        filters: ");
#nullable restore
#line 244 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                            Write(Html.Raw(Model.Filter.SerializeToJson()));

#line default
#line hidden
#nullable disable
            WriteLiteral(",\r\n                        sortby: \'");
#nullable restore
#line 245 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                            Write(Model.SortBy);

#line default
#line hidden
#nullable disable
            WriteLiteral("\',\r\n                        sortdir: \'");
#nullable restore
#line 246 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                             Write(Model.SortDirection);

#line default
#line hidden
#nullable disable
            WriteLiteral("\',\r\n                        q: \'");
#nullable restore
#line 247 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                       Write(Model.Q);

#line default
#line hidden
#nullable disable
            WriteLiteral("\',\r\n                        qfield: \'");
#nullable restore
#line 248 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                            Write(Model.QField);

#line default
#line hidden
#nullable disable
            WriteLiteral("\',\r\n                        page: ");
#nullable restore
#line 249 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                         Write(Model.Page);

#line default
#line hidden
#nullable disable
            WriteLiteral(",\r\n                        currentUrl:\'\',\r\n                        callback:");
#nullable restore
#line 251 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                            Write(Html.Raw(dialogModel.CallBack));

#line default
#line hidden
#nullable disable
            WriteLiteral(",\r\n                        inputid:\'");
#nullable restore
#line 252 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                            Write(Html.Raw(dialogModel.InputId));

#line default
#line hidden
#nullable disable
            WriteLiteral("\',\r\n                        singlemode: ");
#nullable restore
#line 253 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                Write(dialogModel.SingleMode?"true":"false");

#line default
#line hidden
#nullable disable
            WriteLiteral(@",
                        checkedList:[],
                        ajaxTable : function () {
                            var self = $('#entityRecordsModal .datatable');
                            var containerId = '#' + self.attr('data-ajaxcontainer');
                            $(EntityRecordsModel.dialogid + "" "" + containerId).parent().delegate('a[data-ajax=""true""]', 'click', function () {
                                var url = $(this).attr('href');
                                url = url + (url.indexOf('?') == -1 ? '?' : '&') + '__r=' + new Date().getTime();
                                //EntityRecordsModel.pageUrl = url;
                                $(""#entityRecordsModal .datatable"").attr('data-pageurl',url);
                                EntityRecordsModel.rebind(url);
                                return false;
                            });
                        },
                        ajaxgrid_reset : function () {
                            var self = $('#entity");
            WriteLiteral(@"RecordsModal .datatable');
                            EntityRecordsModel.pageUrl = EntityRecordsModel.datatable.attr('data-pageurl');
                            EntityRecordsModel.pag_init();
                            var $inputid = $('#'+EntityRecordsModel.inputid);
                            var $mutilChecker = $('#mutilChecker')
                            if(!EntityRecordsModel.singlemode && $inputid.length>0 && $inputid.val()!=='' && $inputid.attr('data-value') && $inputid.attr('data-value')!=""""){
                                try{
                                    var checklist = $inputid.attr('data-value').split(',');
                                    var checknamelist = $inputid.val().split(',');
                                    var _res = [];
                                    $.each(checklist,function(key,item){
                                        var tempobj = {
                                            id:item,
                                            name:chec");
            WriteLiteral(@"knamelist[key]
                                        }
                                        _res.push(tempobj);
                                    });
                                    $mutilChecker.val(encodeURIComponent(JSON.stringify(_res)));
                                }catch(e){
                                    console.log(e);
                                }
                            }

                            Xms.Web.DataTable(self,{
                                changeHandler:function(obj,type,target){
                                    if(type=='item'){
                                        var $obj = null
                                        if($(obj).find('input[name=""recordid""]').length==0){
                                            $obj = $(obj);
                                        }else{
                                            $obj = $(obj).find('input[name=""recordid""]');
                                        }
                        ");
            WriteLiteral(@"                var _check = $obj.prop('checked');
                                        if(_check){
                                            EntityRecordsModel._addRowInHidden();
                                        }else{
                                            EntityRecordsModel._removeRowByHidden($obj.val());
                                        }
                                    }else{

                                        var _check = $(obj).prop('checked');
                                        if(_check){
                                            EntityRecordsModel._addRowInHidden();
                                        }else{
                                            EntityRecordsModel.datatable.find('tbody').find('input[name=""recordid""]').each(function(){

                                                EntityRecordsModel._removeRowByHidden($(this).val());

                                            });
                                        }

    ");
            WriteLiteral(@"                                }
                                    console.log('changeHandler',_check)
                                }
                            });
                            console.log('pageclick');
                            if(EntityRecordsModel.singlemode==false){

                                console.log('tr.click.binding');
                                EntityRecordsModel.dialog.find("".datatable tbody tr"").off('tr.click').on('tr.click',function(e,data){
                                    var $self = $(this);
                                    var id = $(this).find('input[name=recordid]').val();
                                    console.log('tr.click.trigger',data);
                                    if(data.flag){
                                        if(id){
                                            //console.log('tr.click._removeRowByHidden',id);
                                           // EntityRecordsModel._removeRowByHidden(id);
           ");
            WriteLiteral(@"                                 console.log('remove');
                                        }
                                    }else{
                                        console.log('add');
                                      //  EntityRecordsModel._addRowInHidden();
                                    }
                                });
                                EntityRecordsModel._changepageChecked();
                            }
                            //EntityRecordsModel.ajaxTable();
                            //EntityRecordsModel.datatable.find('tbody>tr').each(function(i, n){
                            //    $(n).bind('dbclick', function(e){alert('abc');
                            //        Xms.Web.SelectingRow(this);
                            //        EntityRecordsModel.dialog_return();
                            //    });
                            //});
                            EntityRecordsModel._changepageChecked();
                        },
");
            WriteLiteral(@"                        _changepageChecked:function(){
                            var $mutilChecker = $('#mutilChecker'),checkedData = $mutilChecker.val();
                            if(checkedData!=''){
                                checkedData = JSON.parse(decodeURIComponent(checkedData));
                            }
                            console.log('checkedData',checkedData);
                            if(checkedData && checkedData.length>0){
                                EntityRecordsModel.dialog.find("".datatable"").find(""input[name=recordid]"").each(function (i, n) {
                                    var flag = false;
                                    $.each(checkedData,function(ii,nn){
                                        if(nn.id == $(n).val()){//如果有重复的就不加进去
                                            flag = true;
                                        }
                                    });
                                    if(flag==true){
                     ");
            WriteLiteral(@"                   $(this).prop('checked',true);
                                    }
                                });
                            }
                        },
                        _removeRowByHidden:function(id){
                            var $mutilChecker = $('#mutilChecker'),checkedData = $mutilChecker.val();
                            var checkedData1= null;
                            if($mutilChecker.val()!=''){
                                checkedData1 = JSON.parse(decodeURIComponent($mutilChecker.val()));
                            }

                            if(checkedData1){
                                var delIndex = null;
                                $.each(checkedData1,function(ii,nn){
                                    if(nn.id == id){//如果有重复的就不加进去
                                        delIndex = ii;
                                        return false;
                                    }
                                });
        ");
            WriteLiteral(@"                        if(~delIndex){
                                    checkedData1.splice(delIndex,1);
                                    console.log('checkedData1',checkedData1);
                                    if(checkedData1.length==0){
                                        $mutilChecker.val('');
                                    }else{
                                        $mutilChecker.val(encodeURIComponent(JSON.stringify(checkedData1)));
                                    }
                                }
                            }
                        },
                        _addRowInHidden:function(){
                            var $mutilChecker = $('#mutilChecker'),checkedData = $mutilChecker.val();

                            if(checkedData!=''){
                                checkedData = JSON.parse(decodeURIComponent(checkedData));
                            }

                            if(checkedData && checkedData.length>0){
                ");
            WriteLiteral(@"                //防止添加重复的数据
                                var result = [];
                                EntityRecordsModel.dialog.find("".datatable"").find(""input[name=recordid]:checked"").each(function (i, n) {
                                    var flag = false;
                                    $.each(checkedData,function(ii,nn){
                                        if(nn.id == $(n).val()){//如果有重复的就不加进去
                                            flag = true;
                                        }
                                    });
                                    if(flag==false){
                                        var obj = new Object();
                                        obj.id = $(n).val();
                                        obj.name = $(n).parents('tr:first').find('input[name=recordname]').val();
                                        result.push(obj);
                                    }
                                });
                           ");
            WriteLiteral(@"     checkedData = checkedData.concat(result);
                            }else{
                                var result = [];
                                EntityRecordsModel.dialog.find("".datatable"").find(""input[name=recordid]:checked"").each(function (i, n) {
                                    var obj = new Object();
                                    obj.id = $(n).val();
                                    obj.name = $(n).parents('tr:first').find('input[name=recordname]').val();
                                    result.push(obj);
                                });
                                checkedData = result;
                            }
                            console.log('checkedData',checkedData)
                            $mutilChecker.val(encodeURIComponent(JSON.stringify(checkedData)));
                        },
                        _emptyCheckerValue:function(){
                            var $mutilChecker = $('#mutilChecker'),checkedData = $mutilChecker.");
            WriteLiteral(@"val();
                            $mutilChecker.val('');
                        },
                        pag_init : function () {

                            var a = $(EntityRecordsModel.dialogid + ' .page-selection');
                            var pageSetting = {
                                total: a.attr('data-total')
                                , maxVisible: 5
                                , page: a.attr('data-page')
                                , leaps: false
                                , prev: '&lsaquo;'
                                , next: '&rsaquo;'
                                , firstLastUse: true
                                , first: '&laquo;'
                                , last: '&raquo;'
                            };
                            $(EntityRecordsModel.dialogid + ' .page-selection').bootpag(pageSetting).on(""page"", function (event, /* page number here */ num) {
                                event.preventDefault();
                ");
            WriteLiteral(@"                EntityRecordsModel.page = num;
                                console.log('$(""#entityRecordsModal .datatable"")',$(""#entityRecordsModal .datatable"").attr('data-pageurl'));
                                EntityRecordsModel.rebind($(""#entityRecordsModal .datatable"").attr('data-pageurl'));
                                return false;
                            });
                        },
                        rebind: function (url,filters) {
                            var url = url || '/entity/RecordsDialog';
                            url = url + (url.indexOf('?') == -1 ? '?' : '&') + '__r=' + new Date().getTime();
                            var model = new Object();
                            model.EntityId = EntityRecordsModel.entityid;
                            model.QueryId = EntityRecordsModel.queryid;
                            if(EntityRecordsModel.cacheFilters && EntityRecordsModel.cacheFilters.Filters && EntityRecordsModel.cacheFilters.Filters.length>0){
    ");
            WriteLiteral(@"                            var __filter =  new Xms.Fetch.FilterExpression();
                                __filter.Filters.push(EntityRecordsModel.filters);
                                var filters = EntityRecordsModel.cacheFilters;
                                $.each(filters.Filters,function(key,filter){
                                    if (filter.Conditions[0]
                                        && typeof filter.Conditions[0].Values === ""object"" && filter.Conditions[0].Values.length
                                        && filter.Conditions[0].Values[0].replace(""\s"", """") != """"
                                        || (filter.Conditions[0] && filter.Conditions[0].Values && filter.Conditions[0].Values.length>0 && filter.Conditions[0].Values[1] && filter.Conditions[0].Values[1].replace(""\s"", """") != """")
                                        ) {
                                        __filter.Filters.push(this);
                                    }

                          ");
            WriteLiteral(@"      });
                                model.Filter = __filter;
                            }else{
                                model.Filter = filters || EntityRecordsModel.filters;
                            }
                            model.Q = $.getUrlParam(""q"", url) || EntityRecordsModel.q;
                            model.QField = $.getUrlParam(""qfield"", url) || EntityRecordsModel.qfield;
                            model.SortBy = $.getUrlParam(""sortby"", url)|| EntityRecordsModel.sortby;
                            model.SortDirection = $.getUrlParam(""sortdirection"", url) || EntityRecordsModel.sortdir;
                            model.InputId = $.getUrlParam(""inputid"", url) || EntityRecordsModel.inputid;
                            model.CallBack = $.getUrlParam(""callback"", url) || EntityRecordsModel.callback;
                            model.Page = $.getUrlParam(""page"", url) || EntityRecordsModel.page;
                            model.SingleMode = EntityRecordsModel.singlemode;");
            WriteLiteral(@"
                            model.OnlyEnabledRecords = false;
                            console.log('rebind.model',model);

                            //在多选方式下，把之前页面的数据保存起来
                            if(model.SingleMode==false){

                            }
                            //在多选方式下，把之前页面的数据保存起来-----end
                            Xms.Web.LoadPage(url, model, function (response) {
                                $(EntityRecordsModel.dialogid + ' #gridview' ).html($(response).find('#gridview').html());
                                EntityRecordsModel.ajaxgrid_reset();
                            },null,null,true);
                        },
                        getNum_String: function(s){
                            return s.replace(/[^0-9]/ig,"""")
                        },
                        selectedrow: function(id){
                            EntityRecordsModel.dialog.find('tr[data-id=""'+id+'""]').find('.selectBtn').trigger('click');
                        },
");
            WriteLiteral(@"                        dialog_return : function (obj) {
                            var result = new Array();
                            if(!obj){
                                EntityRecordsModel.dialog.find("".datatable"").find(""input[name=recordid]:checked"").each(function (i, n) {
                                    var obj = new Object();
                                    obj.id = $(n).val();
                                    obj.name = $(n).parents('tr:first').find('input[name=recordname]').val();
                                    result.push(obj);
                                });
                            }else{//防止多选时，始终是传回第一个已勾选上的值
                                var partr = $(obj).parents('tr:first');
                                var partrDom = partr.get(0);
                                var partrobj = {
                                    id:partr.find(""input[name=recordid]"").val(),
                                    name:partr.find('input[name=recordname]').val()
  ");
            WriteLiteral(@"                              }
                                result.push(partrobj);
                                EntityRecordsModel.dialog.find("".datatable"").find(""input[name=recordid]:checked"").each(function (i, n) {
                                    if($(n).parents('tr:first').get(0)==partrDom){return true;}
                                    var obj = new Object();
                                    obj.id = $(n).val();
                                    obj.name = $(n).parents('tr:first').find('input[name=recordname]').val();
                                    result.push(obj);
                                });
                            }

                            if(EntityRecordsModel.singlemode==false){
                                var $mutilChecker = $('#mutilChecker'),checkedData = $mutilChecker.val();
                                if(checkedData!=''){
                                    checkedData = JSON.parse(decodeURIComponent(checkedData));
                 ");
            WriteLiteral(@"                   result = checkedData;
                                }
                            }
                            if(result.length == 0){
                                Xms.Web.Alert(false, LOC_NOTSPECIFIED_RECORD);
                                return;
                            }
                            var dialog = $(EntityRecordsModel.dialogid);
                            console.log(result, EntityRecordsModel.inputid, dialog.data().OpenDialogCallback);
                            if (dialog.data().OpenDialogCallback) {
                                dialog.data().OpenDialogCallback(result, EntityRecordsModel.inputid)
                            } else {
                                EntityRecordsModel.callback && EntityRecordsModel.callback(result, EntityRecordsModel.inputid);
                            }

                            if($(""#""+EntityRecordsModel.inputid).length>0){
                                $(""#""+EntityRecordsModel.inputid).trigger(""di");
            WriteLiteral(@"alog.return"",result);
                            }
                            //Xms.Web.Event.publish({result:result, inputid: EntityRecordsModel.inputid});
                            EntityRecordsModel.dialog.modal('hide');
                            //Xms.Web.CloseDialog('#entityRecordsModal');
                        },
                        CreateRecord: function () {
                            var url = '/entity/create?entityid=' + EntityRecordsModel.entityid;
                            Xms.Web.OpenWindow(ORG_SERVERURL+url);
                        }
                        ,enterSearch :function(e){
                            console.log(e);
                            e = e || window.event;
                            if(e.preventDefault){
                                e.preventDefault();
                            }else{
                                e.returnValue = false;
                            }
                            EntityRecordsModel.page = 1;
          ");
            WriteLiteral(@"                  EntityRecordsModel.q = $(EntityRecordsModel.dialogid + ' #Q').val();
                            EntityRecordsModel.qfield = $(EntityRecordsModel.dialogid + ' #QField').val();
                            EntityRecordsModel.rebind();
                        }
                    };
                    $(function () {
                        EntityRecordsModel.ajaxTable();
                        EntityRecordsModel.ajaxgrid_reset();
                       // EntityRecordsModel.rebind(EntityRecordsModel.pageUrl);
                        //默认第一列为快速查找字段
                        //$(EntityRecordsModel.dialogid+' #fieldDropdown').next().find('a:eq(1)').trigger('click');
                        EntityRecordsModel.dialog.modal({
                            backdrop:'static'
                        });
                        EntityRecordsModel.dialog.on('hidden.bs.modal', function () {
                            Xms.Web.CloseDialog(EntityRecordsModel.dialogid);
                       ");
            WriteLiteral(@" });
                        $(EntityRecordsModel.dialogid + ' button[name=clearBtn]').off('click').on('click',null,function(e){
                            $(EntityRecordsModel.dialogid + ' #Q').val('');
                            EntityRecordsModel.q = '';
                            EntityRecordsModel.cacheFilters = new Xms.Fetch.FilterExpression();
                            EntityRecordsModel.rebind();
                            EntityRecordsModel._emptyCheckerValue();
                        });
                        $(EntityRecordsModel.dialogid + ' button[name=searchBtn]').off('click').on('click',null,function(e){
                            EntityRecordsModel.enterSearch(e);
                        });
                        $(EntityRecordsModel.dialogid + ' button[name=createBtn]').off('click').on('click',null,function(e){
                            EntityRecordsModel.CreateRecord();
                        });
                        $(EntityRecordsModel.dialogid + ' button[nam");
            WriteLiteral(@"e=deleteBtn]').off('click').on('click',null,function(e){
                            EntityRecordsModel.DeleteRecord();
                        });
                        $(EntityRecordsModel.dialogid + ' .dropdown-menu').on('click','>li>a',function(e){
                            $(EntityRecordsModel.dialogid + ' #QField').val($(this).attr('data-name'))
                            $(EntityRecordsModel.dialogid + ' #fieldDropdown').find('span:first').text($(this).text());
                        });
                        $('body').off('click.selectentitydialog').on('click.selectentitydialog',EntityRecordsModel.dialogid + ' .selectBtn',function(e){
                            Xms.Web.SelectingRow(this);
                            EntityRecordsModel.dialog_return(this);
                        });

                        $(EntityRecordsModel.dialogid + "" button[name='returnBtn']"").click( function() {
                            EntityRecordsModel.dialog_return();
                        });
");
            WriteLiteral(@"                        $(EntityRecordsModel.dialogid + "" #Q"").off('keydown.enter').on('keydown.enter', function(e) {
                            e = e || window.event;
                            if(e.keyCode==13){
                                EntityRecordsModel.enterSearch(e);
                            }
                        });

                        $('#filterSearcher').tableFiler({
                            table:$('#entityRecordsModal .datatable')
                            ,styles:""customer-filter-style""
                            ,clear:function(pluger,filters){
                                EntityRecordsModel.cacheFilters = new Xms.Fetch.FilterExpression();
                                EntityRecordsModel.rebind(null);
                            }
                            ,confirm:function(pluger,filters){
                            //if(EntityRecordsModel.filters.conditions.length>1){
                           //     EntityRecordsModel.filters.conditions = Ent");
            WriteLiteral(@"ityRecordsModel.filters.conditions.slice(0,1);
                            // }
                                var _filter = new Xms.Fetch.FilterExpression();
                                $.each(filters,function(key,filter){
                                    if (filter.Conditions[0]
                                        && typeof filter.Conditions[0].Values === ""object"" && filter.Conditions[0].Values.length
                                        && filter.Conditions[0].Values[0].replace(""\s"", """") != """"
                                        || (filter.Conditions[0] && filter.Conditions[0].Values && filter.Conditions[0].Values.length>0 && filter.Conditions[0].Values[1] && filter.Conditions[0].Values[1].replace(""\s"", """") != """")
                                        ) {
                                        _filter.Filters.push(this);
                                    }

                                });
                                EntityRecordsModel.cacheFilters = _filter;
  ");
            WriteLiteral(@"                              EntityRecordsModel.rebind();
                            }
                         });
                        console.log($('.selectEntityRecords-datagrid'))
                        //$('.selectEntityRecords-datagrid').cDatagrid({
                        //    entityid: EntityRecordsModel.entityid,
                        //    queryid: EntityRecordsModel.queryId,
                        //    pageModel: { type: ""remote"", rPP: 10, page: 1, strRpp: ""{0}"" },
                        //    columnFilter: function (items) {
                        //        console.log(items)
                        //        $.each(items, function (key, item) {
                        //            item.editable = false;

                        //        });
                        //        return items;
                        //    }
                        //});

                    });

                    window[""EntityRecordsModel""+MODAL_GUID] = EntityRecordsModel;
     ");
            WriteLiteral(@"              })();
                </script>
            </div>
            <div class=""modal-footer"">
                <div class=""pull-left"">
                    <button type=""button"" class=""btn btn-link"" name=""createBtn"">
                        <span class=""glyphicon glyphicon-plus-sign""></span> ");
#nullable restore
#line 681 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                                                       Write(app.T["add"]);

#line default
#line hidden
#nullable disable
            WriteLiteral("\r\n                    </button>\r\n                </div>\r\n                <button type=\"button\" class=\"btn btn-default\"\r\n                        data-dismiss=\"modal\">\r\n                    <span class=\"glyphicon glyphicon-remove\"></span> ");
#nullable restore
#line 686 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                                                Write(app.T["dialog_close"]);

#line default
#line hidden
#nullable disable
            WriteLiteral("\r\n                </button>\r\n                <button type=\"button\" class=\"btn btn-primary\" name=\"returnBtn\">\r\n                    <span class=\"glyphicon glyphicon-ok\"></span> ");
#nullable restore
#line 689 "G:\projects\xms_v2\Presentation\Xms.Web\Views\Entity\RecordsDialog.cshtml"
                                                            Write(app.T["dialog_ok"]);

#line default
#line hidden
#nullable disable
            WriteLiteral("\r\n                </button>\r\n            </div>\r\n        </div><!-- /.modal-content -->\r\n    </div><!-- /.modal-dialog -->\r\n</div><!-- /.modal -->");
        }
        #pragma warning restore 1998
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public Xms.Web.Framework.Context.IWebAppContext app { get; private set; }
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.ViewFeatures.IModelExpressionProvider ModelExpressionProvider { get; private set; }
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.IUrlHelper Url { get; private set; }
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.IViewComponentHelper Component { get; private set; }
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.Rendering.IJsonHelper Json { get; private set; }
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.Rendering.IHtmlHelper<Xms.Web.Models.SelectEntityRecordsDialogModel> Html { get; private set; }
    }
}
#pragma warning restore 1591
