@model Xms.Web.Models.SignInModel
@{
    Layout = null;
}
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="/favicon.ico">

    <title>@app.PlatformSettings.AppName</title>

    <link href="/content/css/bootstrap3.3.5/bootstrap.min.css?v=@app.PlatformSettings.VersionNumber" rel="stylesheet">
    <link href="/content/js/jquery-toast/jquery.toast.min.css?v=@app.PlatformSettings.VersionNumber" rel="stylesheet">
    <style type="text/css">
        html, body {
            height: 100%;
            width: 100%;
        }
        body {
            font: 12px/1.5 'Microsoft YaHei',Tahoma,Helvetica,Arial,'宋体',sans-serif;
        }

        .page-header {
            padding: 10px;
            margin: 0;
            background: rgb(40, 164, 254);
            text-align: center;
        }

        label {
            font-weight: 200;
        }

        .col-md-6.col-md-offset-3 {
            margin-top: 8%;
        }

        .login-bg {
            background: url('/content/images/plogin-bg.jpg') no-repeat;
        }

        .login-wrap {
            padding: 15px;
            border-radius: 8px;
            background-color: rgba(0,0,0,.25);
            box-shadow: 0 0 10px rgba(0,100,250,.1);
            position: fixed;
            margin-top: -220px;
            top: 50%;
            left: 50%;
            transform: translateX(-50%);
        }

        .form-text {
            border: none;
            border-bottom: 1px solid #fff;
            width: 100%;
            outline: none;
            background: none;
            color: #fff;
            height: 30px;
            line-height: 30px;
            white-space: nowrap;
        }

        .field-validation-error {
            color: #ff7676;
        }

        .form-text::-webkit-input-placeholder {
            color: #aaa;
        }

        .form-text:-moz-placeholder {
            color: #aaa;
        }

        .form-text::-moz-placeholder {
            color: #aaa;
        }

        .form-text:-ms-input-placeholder {
            color: #aaa;
        }

        .form-group label {
            color: #fff;
        }

        .login-submit {
            background-color: #f3ffff;
            color: #555;
        }

        .page-footer {
            position: fixed;
            left: 0;
            width: 100%;
            height: 50px;
            line-height: 50px;
            bottom: 20px;
        }

        .copyright {
            color: #fff;
            text-align: center;
            font-size: 14px;
        }
    </style>
</head>

<body class="bg-info login-bg">
                <div class="login-wrap">
                    <div class="text-center">
                        <h3 style="color:white;">@app.PlatformSettings.AppName-登录</h3>
                    </div>
                    <div class="" style="margin-top: 20px;">
                        <div class="col-sm-12">
                            <form id="signinForm" action="/@(app.OrganizationUniqueName)/api/account" method="post" data-jsonajax="true">
                                @*@Html.AntiForgeryToken()*@
                                @Html.HiddenFor(x => x.ReturnUrl)
                                <div class="form-group">
                                    @if (string.IsNullOrWhiteSpace(Model.OrgUniqueName))
                                    {
                                        <input type="text" name="orgname" class="form-text" placeholder="组织代码" />
                                        @Html.ValidationMessageFor(x => x.OrgUniqueName)
                                    }
                                    else
                                    {
                                        <input type="text" class="form-text" value="@Model.OrgName" disabled="disabled" />
                                        <input type="hidden" value="@Model.OrgUniqueName" name="OrgUniqueName" />
                                    }
                                </div>
                                <div class="form-group">
                                    <input type="text" name="loginname" id="LoginName" autocomplete="off" class="form-text loginname" placeholder="帐号" required value="@Model.LoginName" autofocus />

                                </div>
                                <div class="form-group">

                                    <input type="password" name="password" id="password" autocomplete="off" class="form-text loginpwd" placeholder="密码" required value="@Model.Password" />

                                </div>
                                @if (app.PlatformSettings.VerifyCodeEnabled)
                                {
                                    <div class="form-group">
                                        <label for="validcode" class="sr-only">验证码</label>
                                        <input type="text" name="verifycode" id="verifycode" class="form-text" autocomplete="off" placeholder="验证码" required />
                                        <img id="verifyImage" style="cursor:pointer;margin-top: 10px;" title="点击刷新验证码" onclick="this.src='@(!string.IsNullOrWhiteSpace(Model.OrgUniqueName) ? "/" + Model.OrgUniqueName : "")/tool/verifyimage?time=' + new Date()" src="@(!string.IsNullOrWhiteSpace(Model.OrgUniqueName) ? "/" + Model.OrgUniqueName : "")/tool/verifyimage" height="34" class="left" />
                                        <div class="clear"></div>
                                    </div>
                                }
                                <div class="form-group">
                                    <label> @Html.CheckBoxFor(x => x.RememberMe) 记住我</label>
                                </div>
                                <div class="form-group">
                                    <button class="btn login-submit col-sm-12 col-xs-12 col-lg-12 login" type="submit">登录</button>
                                </div>
                            </form>
                        </div>
                        <div class="col-sm-12 col-xs-12 col-lg-12 text-center" style="color:#fff;">版本：@app.PlatformSettings.VersionNumber</div>
                    </div>
                </div>
    <div class="page-footer">
        <div class="copyright">版权所有：<a href="http://www.juyunzh.net" target="_blank">广东云聚天下科技有限公司</a></div>
    </div>
    <script src="/content/js/jquery.min.js"></script>
    <script src="/content/js/jquery-validate/jquery.validate.min.js?v=@app.PlatformSettings.VersionNumber"></script>
    <script src="/content/js/jquery.form.js?v=@app.PlatformSettings.VersionNumber"></script>
    <script src="/content/js/jquery-toast/jquery.toast.min.js?v=@app.PlatformSettings.VersionNumber"></script>
    <script src="/content/js/xms.web.js"></script>
    <script src="/content/js/xms.jquery.js"></script>
    @{await Html.RenderPartialAsync("CommonLabel"); }
    <script>
        var ORG_SERVERURL = '/@(app.OrganizationUniqueName)';
        window.onload = function () {
            if (navigator.appName == "Microsoft Internet Explorer" && navigator.appVersion.split(";")[1].replace(/[ ]/g, "") == "MSIE6.0" || navigator.appName == "Microsoft Internet Explorer" && navigator.appVersion.split(";")[1].replace(/[ ]/g, "") == "MSIE7.0" || navigator.appName == "Microsoft Internet Explorer" && navigator.appVersion.split(";")[1].replace(/[ ]/g, "") == "MSIE8.0") {
                alert("为了您的更好体验，请使用IE9及以上版本浏览网页");
            }
        }
        $(function () {
            if (top.location != location) {
                top.location.href = location.href;
            }
            var returnUrl = $('#ReturnUrl').val();
            //Xms.Web.Form($('form'), function (response) {
            //    Xms.Web.Toast(response.Content, response.IsSuccess);
            //    if (response.IsSuccess == true) {
            //        if (returnUrl) {
            //            location.href = returnUrl;
            //        } else {
            //            location.href = ORG_SERVERURL;
            //        }
            //    } else {
            //            $('#verifyImage').trigger('click');
            //    }
            //    return false;
            //});
            var debound = $.deboundsEvent(3000, true);
            $('form').submit(function () {
                var that = this;
                debound(function () {
                    $(that).ajaxSubmit(function (response) {
                        Xms.Web.Toast(response.Content, response.IsSuccess);
                        if (response.IsSuccess == true) {
                            if (returnUrl) {
                                location.href = returnUrl;
                            } else {
                                location.href = ORG_SERVERURL;
                            }
                        } else {
                            $('#verifyImage').trigger('click');
                        }
                    });
                })
                //console.log(response);
                return false;
            });

        });
    </script>
</body>
</html>